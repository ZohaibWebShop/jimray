
{%- doc -%}
  Renders a header menu block.

  @param {string} [variant] - What version of the menu to render. Defaults to header menu.
  @param {string} [transparent] - Show a transparent menu
{%- enddoc -%}

{% liquid
  assign block_settings = block.settings
%}

{% case variant %}
  {% when 'mobile' %}
    <div
      class="header__drawer"
      ref="headerDrawerContainer"
      data-hydration-key="header-drawer-mobile"
      {{ block.shopify_attributes }}
    >
      {% render 'header-drawer', linklist: block_settings.menu, data_header_drawer_type: 'mobile-drawer' %}
    </div>

  {% when 'navigation_bar' %}
    {% if block_settings.navigation_bar == true %}
      <div
        class="menu-list menu-list--mobile{% if transparent == blank %} color-{{ block_settings.color_scheme_navigation_bar }}{% endif %}"
        style="--menu-horizontal-gap: 15px; --mobile-nav-margin: auto;"
        data-hydration-key="header-menu-mobile-navigation-bar"
      >
        <div class="menu-list__scroll-container">
          <ul
            class="menu-list__list list-unstyled"
            role="list"
          >
            {% for link in block_settings.menu.links %}
              <li>
                <a
                  href="{{ link.url }}"
                  id="MenuItem-{{ link.handle }}"
                  class="menu-list__item"
                  {% if link.current %}
                    aria-current="page"
                  {% endif %}
                >
                  {{- link.title -}}
                </a>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    {% endif %}
  {% else %}
    {% liquid
      assign block_settings = block.settings
      assign menu_content_type = block_settings.menu_style | default: 'text'
      assign image_border_radius = block_settings.image_border_radius
      assign color_scheme_classes = ''
      assign color_scheme_setting_id = 'color_scheme_' | append: section.settings.menu_row
      assign current_color_scheme = block_settings.color_scheme
      assign parent_color_scheme = section.settings[color_scheme_setting_id]

      if parent_color_scheme.id != current_color_scheme.id
        assign color_scheme_classes = ' color-' | append: current_color_scheme
      endif

      # Check if header and menu colors match. This is used to apply different padding styles in css
      if parent_color_scheme.settings.background.rgb == current_color_scheme.settings.background.rgb
        assign color_scheme_classes = color_scheme_classes | append: ' color-scheme-matches-parent'
      endif

      if block_settings.menu_style == 'featured_collections'
        assign ratio = block_settings.featured_collections_aspect_ratio
      elsif block_settings.menu_style == 'featured_products'
        assign ratio = block_settings.featured_products_aspect_ratio
      endif
    %}

    {% capture children %}
      {% for link in block_settings.menu.links %}
        <li
          role="presentation"
          class="menu-list__list-item"
          on:focus="/activate"
          on:blur="/deactivate"
          on:pointerenter="/activate"
          on:pointerleave="/deactivate"
        >
          <a
            href="{{ link.url }}"
            data-skip-node-update="true"
            class="menu-list__link{% if link.active %} menu-list__link--active{% endif %}"
            {%- if link.links != blank -%}
              aria-controls="submenu-{{ forloop.index }}"
              aria-haspopup="true"
              aria-expanded="false"
            {%- endif -%}
            {% if link.current %}
              aria-current="page"
            {% endif %}
            ref="menuitem"
          >
            <span class="menu-list__link-title">{{- link.title -}}</span>
          </a>
          {%- if link.links != blank -%}
            <div class="menu-list__submenu dropdown-menu{{ color_scheme_classes }}" ref="submenu[]">
              <div
                id="submenu-{{ forloop.index }}"
                class="dropdown-menu__inner"
                style="{% render 'submenu-font-styles', settings: block_settings %}"
              >
                <ul class="dropdown-menu__list list-unstyled">
                  {% for childLink in link.links %}
                    <li class="dropdown-menu__item">
                      <a href="{{ childLink.url }}" class="dropdown-menu__link{% if childLink.links != blank %} dropdown-menu__link--has-submenu{% endif %}">
                        <span class="dropdown-menu__link-text">{{ childLink.title }}</span>
                        {%- if childLink.links != blank -%}
                          <span class="dropdown-menu__arrow">
                            <svg width="8" height="8" viewBox="0 0 8 8" fill="none">
                              <path d="M2 3L4 5L6 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                          </span>
                        {%- endif -%}
                      </a>
                      {%- if childLink.links != blank -%}
                        <ul class="dropdown-menu__sublist list-unstyled">
                          {% for grandchildLink in childLink.links %}
                            <li class="dropdown-menu__subitem">
                              <a href="{{ grandchildLink.url }}" class="dropdown-menu__sublink">
                                {{ grandchildLink.title }}
                              </a>
                            </li>
                          {% endfor %}
                        </ul>
                      {%- endif -%}
                    </li>
                  {% endfor %}
                </ul>
              </div>
            </div>
          {%- endif -%}
        </li>
      {% endfor %}
      <li
        class="menu-list__list-item"
        role="presentation"
        slot="more"
        on:focus="/activate"
        on:blur="/deactivate"
        on:pointerenter="/activate"
        on:pointerleave="/deactivate"
      >
        <button role="listitem" class="menu-list__link button-unstyled">
          <span class="menu-list__link-title">{{ 'actions.more' | t }}</span>
        </button>
      </li>
    {% endcapture %}

    <header-menu
      ref="headerMenu"
      class="header-menu"
      {{ block.shopify_attributes }}
      data-hydration-key="header-menu"
    >
      <div class="header-menu__inner">
        <nav
          class="menu-list"
          aria-label="{{ 'accessibility.header_navigation_label' | t }}"
          style="{% render 'menu-font-styles', settings: block_settings %}"
        >
          {% assign class = 'overflow-menu' | append: color_scheme_classes %}
          {% render 'overflow-list',
            class: class,
            ref: 'overflowMenu',
            children: children,
            minimum-items: 2,
            data-testid: 'header-menu-overflow-list',
            attributes: 'data-skip-node-update'
          %}
        </nav>
      </div>

      <script
        src="{{ 'header-menu.js' | asset_url }}"
        type="module"
        fetchpriority="low"
      ></script>
    </header-menu>
{% endcase %}

{% style %}
  .header__underlay {
    --color-submenu: rgb({{ block_settings.color_scheme.settings.background.rgba }});
  }
{% endstyle %}
{% stylesheet %}
  .header__drawer {
    --header-drawer-min-height: 60px;
    display: flex;
    min-height: var(--header-drawer-min-height);
    align-items: center;
  }

  #header-component[data-menu-style='drawer'] .header__drawer {
    display: flex;
    min-height: var(--header-drawer-min-height);
  }

  @media screen and (min-width: 750px) {
    #header-component[data-menu-style='menu'] .header__drawer {
      display: none;
      min-height: 0;
    }
  }

  .header--compact .header__drawer {
    min-height: var(--minimum-touch-target);
  }

  .menu-list--mobile {
    &.menu-list {
      display: grid;
    }

    & .menu-list__list {
      width: max-content;
      margin-inline: auto;
      gap: var(--menu-horizontal-gap);
    }

    & li {
      width: max-content;
      padding-block: var(--padding-sm);
    }

    & li:first-of-type {
      padding-inline-start: var(--menu-horizontal-gap);
    }

    & li:last-of-type {
      padding-inline-end: var(--menu-horizontal-gap);
    }

    & a {
      color: var(--color-foreground);
    }
  }

  .menu-list__scroll-container {
    position: relative;
    overflow-x: auto;
    mask-image: linear-gradient(to right, transparent, #000 20px, #000 calc(100% - 20px), transparent);
    padding-block: var(--padding-2xs);
  }

  .menu-list {
    --menu-horizontal-gap: var(--gap-xl);
    --menu-vertical-gap: var(--gap-xl);

    display: flex;
    height: 100%;
  }

  .menu-list__list {
    display: flex;
    justify-content: var(--grid-area-alignment);
  }

  .menu-list__list-item {
    position:relative;
    flex-shrink: 0;
    white-space: nowrap;
    display: flex;
    align-items: center;
    justify-content:center;
    height: 100%;
    /* margin-right: 10px; */
  }

  .menu-list__list-item[aria-hidden='true'] {
    visibility: hidden;
  }

  .menu-list__link {
    --menu-top-level-font-weight: 700;
    --menu-top-level-font-line-height: 22px;
    --menu-top-level-font-size: 16px;
    --menu-top-level-font-case: uppercase;
    --menu-top-level-font-color: #333333;
    position: relative;
    font-family: var(--menu-top-level-font-family);
    font-style: var(--menu-top-level-font-style);
    font-weight: var(--menu-top-level-font-weight);
    font-size: var(--menu-top-level-font-size);
    line-height: var(--menu-top-level-font-line-height);
    text-transform: var(--menu-top-level-font-case);
    color: var(--menu-top-level-font-color);
    text-decoration: none;
    display: flex;
    flex-direction: column;
    justify-content: center;
    cursor: pointer;
    padding: 14px 15px;
    margin-block: 0;
    text-align: center;

    &:after{
      content:"";
      position:absolute;
      bottom:0;
      left:0;
      width:0px;
      height: 100%;
      --menu-top-level-font-color: #7B0002;
      background-color: var(--menu-top-level-font-color);
      z-index:-1;
      transition: width 0.3s ease-in-out;
    }
    &:hover,
    &:focus {
      --menu-top-level-font-color: #ffffff;
      color: var(--menu-top-level-font-color);
      &:after{
        width:100%;
      }
    }

    @media screen and (min-width: 750px) {
      --menu-top-level-font-size-desktop: 16px;
      font-size: var(--menu-top-level-font-size-desktop);
    }
  }

  /* .menu-list__link-title {
    padding-inline: calc(var(--gap-xl) / 2);
  } */
  [slot='overflow'] .menu-list__link-title {
    padding-inline: 0;
  }

  .menu-list__list-item:not([slot='overflow']) {
    flex-direction: column;
  }
  .menu-list__list-item:not([slot='overflow'])::after {
    content: '';
    width: 100%;
    height: var(--header-padding);
    margin-bottom: calc(-1 * var(--header-padding));
  }

  [slot='overflow'] > .menu-list__link::after {
    content: none;
  }

  /*
    High specificity selectors to subdue non-hovered links without javascript.
    If the need for js-generated `hovered` and `focused` classes arises for another reason we can simplify these.
  */
  .menu-list:where(:has(.menu-list__list-item:hover)),
  .menu-list:where(:has(.menu-list__list-item:focus-within)),
  .menu-list:where(:has(.menu-list__list-item:not([aria-hidden='true']) .menu-list__link--active)) {
    .menu-list__link {
      --menu-top-level-font-color-rgb: 255,255,255;
      color: #333333;
    }
  }

  /* stylelint-disable-next-line selector-max-specificity */
  .menu-list:not(:has(.menu-list__list-item:hover)) .menu-list__link--active,
  .menu-list .menu-list__list-item:where(:hover, :focus-within) .menu-list__link,
  .menu-list .menu-list__list-item[slot='overflow'] .menu-list__link[aria-expanded='true'] {
    --menu-top-level-font-color:#ffffff;
    color: var(--menu-top-level-font-color);
    &:after{
      width:100%;
    }
  }

  .overflow-menu::part(list) {
    /* Make sure focus outline is not cut off by overflow hidden */
    --focus-outline-size: calc(var(--focus-outline-offset) + var(--focus-outline-width));

    gap: 0;
    margin-inline: calc(-1 * var(--menu-horizontal-gap) / 2);
  }

  .overflow-menu {
    background-color: transparent;
    padding: var(--focus-outline-size);
    margin: calc(-1 * var(--focus-outline-size));
  }

  /** dropdown menu **/
  .menu-list__submenu.dropdown-menu {
    --submenu-padding-block-start: var(--padding-sm);
    --submenu-padding-block-end: var(--padding-sm);
    --color-background: #FFFFFF;
    background-color: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-popover);
    /* Prevent dropdown from triggering header underlay */
    contain: layout style;
  }

  .menu-list__list-item:where(:not([slot='overflow'])) > .menu-list__submenu.dropdown-menu {
    --submenu-content-opacity: 0;
    --submenu-content-animation: opacity var(--animation-speed) var(--animation-easing);

    visibility: hidden;
    position: absolute;
    width: max-content;
    white-space: nowrap;
    left: 0;
    transform: translateY(-10px);
    top: 100%;
    z-index: var(--layer-header-menu);
    transition: opacity var(--animation-speed) var(--animation-easing), 
                transform var(--animation-speed) var(--animation-easing),
                visibility var(--animation-speed) var(--animation-easing);
  }

  /* Show the dropdown on hover */
  .menu-list__list-item:has([aria-expanded='true']) > .menu-list__submenu.dropdown-menu,
  .menu-list__list-item:hover > .menu-list__submenu.dropdown-menu,
  .menu-list__submenu.dropdown-menu:hover {
    --submenu-content-opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  /* Dropdown menu content styles */
  .dropdown-menu__inner {
    padding-block-start: var(--submenu-padding-block-start);
    padding-block-end: var(--submenu-padding-block-end);
    padding-inline: var(--padding-sm);
    opacity: var(--submenu-content-opacity);
    transition: var(--submenu-content-animation);
  }

  .dropdown-menu__list {
    display: flex;
    flex-direction: column;
    gap: 0;
    width: max-content;
  }

  .dropdown-menu__item {
    position: relative;
    border-bottom: 1px solid var(--color-border);
  }

  .dropdown-menu__item:last-child {
    border-bottom: none;
  }

  .dropdown-menu__link {
    display: flex;
    align-items: center;
    justify-content: space-between;
    --padding-xs: 13px;
    padding: var(--padding-xs) var(--padding-sm);
    --color-foreground: #333333;
    color: var(--color-foreground);
    text-decoration: none;
    border-radius: var(--border-radius-sm);
    white-space: nowrap;
    transition: background-color var(--animation-speed) var(--animation-easing),
                color var(--animation-speed) var(--animation-easing);
  }

  .dropdown-menu__link--has-submenu {
    padding-right: var(--padding-lg);
  }

  .dropdown-menu__arrow {
    display: flex;
    align-items: center;
    margin-left: var(--padding-sm);
    transform: rotate(-90deg);
    transition: transform var(--animation-speed) var(--animation-easing);
  }

  .dropdown-menu__arrow svg {
    width: 8px;
    height: 8px;
    color: var(--color-foreground);
  }

  .dropdown-menu__link:hover {
    background-color: var(--color-background-accent);
    color: var(--color-foreground-accent);
  }

  .dropdown-menu__sublist {
    position: absolute;
    left: 100%;
    top: 0;
    width: max-content;
    white-space: nowrap;
    background-color: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: var(--border-radius);
    padding: var(--padding-xs);
    opacity: 0;
    visibility: hidden;
    transition: opacity var(--animation-speed) var(--animation-easing),
                transform var(--animation-speed) var(--animation-easing),
                visibility var(--animation-speed) var(--animation-easing);
  }

  .dropdown-menu__item:hover .dropdown-menu__sublist {
    opacity: 1;
    visibility: visible;
    transform: translateX(0);
  }

  .dropdown-menu__sublink {
    display: block;
    padding: 13px var(--padding-xs);
    --color-foreground: #333333;
    color: var(--color-foreground);
    text-decoration: none;
    border-bottom: 1px solid var(--color-border);
    border-radius: var(--border-radius-sm);
    font-size: var(--font-size-sm);
    transition: background-color var(--animation-speed) var(--animation-easing),
                color var(--animation-speed) var(--animation-easing);
  }

  .dropdown-menu__sublink:hover {
    background-color: var(--color-background-accent);
    color: var(--color-foreground-accent);
  }

  .header-menu {
    height: 100%;
  }


{% endstylesheet %}

{% schema %}
{
  "name": "t:names.menu",
  "tag": null,
  "settings": [
    {
      "type": "link_list",
      "id": "menu",
      "label": "t:settings.menu",
      "default": "main-menu"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:settings.color_scheme",
      "default": "primary"
    },
    {
      "type": "header",
      "content": "t:content.typography"
    },
    {
      "type": "select",
      "id": "type_font_primary_size",
      "label": "t:settings.top_level_size",
      "options": [
        {
          "value": "0.625rem",
          "label": "10px"
        },
        {
          "value": "0.75rem",
          "label": "12px"
        },
        {
          "value": "0.875rem",
          "label": "14px"
        },
        {
          "value": "1rem",
          "label": "16px"
        },
        {
          "value": "1.125rem",
          "label": "18px"
        }
      ],
      "default": "1rem"
    },
    {
      "type": "select",
      "id": "menu_font_style",
      "label": "t:settings.submenu_size",
      "options": [
        {
          "value": "regular",
          "label": "t:options.small"
        },
        {
          "value": "inverse",
          "label": "t:options.medium"
        },
        {
          "value": "inverse_large",
          "label": "t:options.large"
        }
      ],
      "default": "inverse"
    },
    {
      "type": "select",
      "id": "type_font_primary_link",
      "label": "t:settings.font",
      "options": [
        {
          "value": "body",
          "label": "t:options.body"
        },
        {
          "value": "subheading",
          "label": "t:options.subheading"
        },
        {
          "value": "heading",
          "label": "t:options.heading"
        },
        {
          "value": "accent",
          "label": "t:options.accent"
        }
      ],
      "default": "heading"
    },
    {
      "type": "select",
      "id": "type_case_primary_link",
      "label": "t:settings.text_case",
      "options": [
        {
          "value": "none",
          "label": "t:options.default"
        },
        {
          "value": "uppercase",
          "label": "t:options.uppercase"
        }
      ],
      "default": "none"
    },
    {
      "type": "header",
      "content": "t:content.submenu_feature"
    },
    {
      "type": "select",
      "id": "menu_style",
      "label": "t:settings.media_type",
      "info": "t:info.media_type_info",
      "options": [
        {
          "value": "text",
          "label": "t:options.none"
        },
        {
          "value": "collection_images",
          "label": "t:options.collection_images"
        },
        {
          "value": "featured_products",
          "label": "t:options.featured_products"
        },
        {
          "value": "featured_collections",
          "label": "t:options.featured_collections"
        }
      ],
      "default": "collection_images"
    },
    {
      "type": "select",
      "id": "featured_products_aspect_ratio",
      "label": "t:settings.image_ratio",
      "options": [
        {
          "value": "adapt",
          "label": "t:options.auto"
        },
        {
          "value": "4 / 5",
          "label": "t:options.portrait"
        },
        {
          "value": "1 / 1",
          "label": "t:options.square"
        }
      ],
      "default": "4 / 5",
      "visible_if": "{{ block.settings.menu_style == 'featured_products' }}"
    },
    {
      "type": "select",
      "id": "featured_collections_aspect_ratio",
      "label": "t:settings.image_ratio",
      "options": [
        {
          "value": "adapt",
          "label": "t:options.auto"
        },
        {
          "value": "16 / 9",
          "label": "t:options.landscape"
        },
        {
          "value": "1 / 1",
          "label": "t:options.square"
        }
      ],
      "default": "16 / 9",
      "visible_if": "{{ block.settings.menu_style == 'featured_collections' }}"
    },
    {
      "type": "range",
      "id": "image_border_radius",
      "label": "t:settings.image_border_radius",
      "min": 0,
      "max": 32,
      "step": 1,
      "unit": "px",
      "default": 0,
      "visible_if": "{{ block.settings.menu_style != 'text' }}"
    },
    {
      "type": "header",
      "content": "t:content.mobile_layout"
    },
    {
      "type": "checkbox",
      "id": "navigation_bar",
      "label": "t:settings.navigation_bar"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme_navigation_bar",
      "label": "t:settings.navigation_bar_color_scheme",
      "default": "primary",
      "visible_if": "{{ block.settings.navigation_bar }}"
    },
    {
      "type": "checkbox",
      "id": "drawer_accordion",
      "label": "t:settings.accordion",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "drawer_accordion_expand_first",
      "label": "t:settings.expand_first_group",
      "default": false,
      "visible_if": "{{ block.settings.drawer_accordion == true }}"
    },
    {
      "type": "checkbox",
      "id": "drawer_dividers",
      "label": "t:settings.dividers",
      "default": false
    }
  ]
}
{% endschema %}
